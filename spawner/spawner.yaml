---
region: us-east-1

# List the application ("host classes") and properties of them

# Instance types are from https://docs.google.com/a/amplify.com/spreadsheets/d/1KI4Cduq1NdBEtQX2mQMjKqYEDsjixTdUqYt4q8VZwO0/edit#gid=2140568744
# Application names are from https://docs.google.com/a/amplify.com/spreadsheets/d/1vtYyCL50Ii3wHeNDsWYlu-YVjjBSORzZQZOKvnLAgkM/edit#gid=2108299998
# Security group names are from https://docs.google.com/a/amplify.com/spreadsheets/d/1vtYyCL50Ii3wHeNDsWYlu-YVjjBSORzZQZOKvnLAgkM/edit#gid=2108299998

apps:
  
  # Array order indicates spawn order when called from the environment deployer.
  # - name: app_name
  #   ami_app_name: other_thing # Optional.  Use this to override which AMI is used.  Will look for an AMI that has an application:other_thing tag.
  #   security_groups:
  #     - sg-name-01 # Array of SG names
  #     - sg-name-02 # Array of SG names
  #   instance_type: t1.micro # Required
  #   subnet_type: private # One of private, public, or lz.  Defaults to private.
  #   public_ip: True or False, defaults to false.
  #   spawn_count:  # Default initial spawn when called by the env builder.
  #    env_name: INT # 0 disables spawning from env-builder

  - name: ansible
    ami_app_name: base # Playbook runs from base
    security_groups:
      - srl-default
      - srl-logging
      - omniti-fulton-office
    instance_type: t1.micro
    public_ip: True
    spawn_count:
      dev: 0  # Deployed by external bootstrapper
      prod: 0

  - name: bind
    ami_app_name: base # TODO: remove this when the real AMI is available
    security_groups:
      - srl-default
      - srl-logging
      - srl-bind
    instance_type: m3.medium # TODO: verify    
    spawn_count:
      dev: 0  # TODO
      prod: 0  # Not managed by SRL in prod

  - name: gluster-server
    ami_app_name: base # Playbook runs from base
    security_groups:
      - srl-default
      - srl-glusterfs
      - srl-logging
    instance_type: m3.medium # TODO: verify    
    spawn_count:
      dev: 0 # TODO
      prod: 0 # TODO

  - name: loghost
    ami_app_name: base # Playbook runs from base
    security_groups:
      - srl-default
      - srl-logstash
    instance_type: m2.xlarge 
    spawn_count:
      dev: 1
      prod: 0


  # Deployment not ordered beyond this point

  - name: memcached
    ami_app_name: memcached 
    security_groups:
      - srl-default
      - srl-memcached
      - srl-logging
    instance_type: m2.4xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: db-master
    ami_app_name: db-master 
    security_groups:
      - srl-default
      - srl-db
      - srl-logging
    instance_type: r3.2xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: db-pgbouncer
    ami_app_name: base # TODO: remove this when the real AMI is available
    security_groups:
      - srl-default
      - srl-db-client
      - srl-db-pgbouncer
      - srl-logging
    instance_type: m3.xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: db-pgpool
    ami_app_name: pg-pool 
    security_groups:
      - srl-default
      - srl-db-client
      - srl-db-pool
      - srl-logging
    instance_type: m3.xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: db-slave # TODO: may be split; there are actually two - one for extraction and one for reporting
    ami_app_name: db-slave 
    security_groups:
      - srl-default
      - srl-db
      - srl-logging
    instance_type: r3.2xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: hpz-db
    ami_app_name: db # per doris
    security_groups:
      - srl-default
      - srl-db
      - srl-logging
    instance_type: m3.2xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: hpz-web
    ami_app_name: hpz-web
    security_groups:
      - srl-default
      - srl-db-client
      - srl-glusterfs-hpz-client
      - srl-logging
    instance_type: m3.xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: lz
    ami_app_name: lz
    security_groups:
      - srl-default
      - srl-logging
    instance_type: m3.xlarge
    spawn_count:
      dev: 0
      prod: 0


  - name: file-trigger
    ami_app_name: file-trigger 
    security_groups:
      - srl-default
      - srl-logging
      - srl-rmq-client
      - srl-glusterfs-udl-client
    instance_type: t1.micro 
    spawn_count:
      dev: 0
      prod: 0

  - name: file-grabber
    ami_app_name: file-grabber
    security_groups:
      - srl-default
      - srl-logging
    instance_type: t1.micro
    spawn_count:
      dev: 0
      prod: 0

  - name: migrate-db
    ami_app_name: db 
    security_groups:
      - srl-default
      - srl-db
      - srl-db-client
      - srl-db-pool-pcp
      - srl-rmq-client
      - srl-logging
    instance_type: m3.2xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: migrate-rabbit
    ami_app_name: rabbit
    security_groups:
      - srl-default
      - srl-logging
      - srl-rmq
    instance_type: m3.2xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: reporting-cache-warmer
    ami_app_name: reporting-generator # per doris
    security_groups:
      - srl-default
      - srl-memcached
      - srl-logging
    instance_type: m3.large
    spawn_count:
      dev: 0
      prod: 0

  - name: reporting-generator-pdf
    ami_app_name: reporting-generator # per doris
    security_groups:
      - srl-default
      - srl-rmq-client
      - srl-logging
    instance_type: m3.large
    spawn_count:
      dev: 0
      prod: 0

  - name: reporting-rabbit-services
    ami_app_name: rabbit
    security_groups:
      - srl-default
      - srl-rmq
      - srl-logging
    instance_type: m3.xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: reporting-rabbit-extract
    ami_app_name: rabbit
    security_groups:
      - srl-default
      - srl-db-pool-client
      - srl-rmq-client
      - srl-web-client
      - srl-glusterfs-extract-client
      - srl-logging
    instance_type: m3.xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: reporting-web
    ami_app_name: reporting-web
    security_groups:
      - srl-default
      - srl-db-pool-client
      - srl-rmq-client
      - srl-memcached
      - srl-web
      - srl-logging
    instance_type: m3.xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: reporting-worker-extract
    ami_app_name: reporting-worker-extract 
    security_groups:
      - srl-default
      - srl-db-pool-client
      - srl-rmq-client
      - srl-web-client
      - srl-glusterfs-extract-client
      - srl-logging
    instance_type: m3.2xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: reporting-worker-pdf
    ami_app_name: reporting-worker-pdf
    security_groups:
      - srl-default
      - srl-rmq-client
      - srl-sso-client
      - srl-web-client
      - srl-glusterfs-pdf-client
      - srl-logging
    #instance_type: r3.2xlarge # TODO: existing image is PV, r3 requires HVM
    instance_type: m2.4xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: tsb-rabbit
    ami_app_name: rabbit
    security_groups:
      - srl-default
      - srl-rmq
      - srl-logging
    instance_type: m3.xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: tsb-trigger
    ami_app_name: tsb-trigger
    security_groups:
      - srl-default
      - srl-logging
    instance_type: m3.large
    spawn_count:
      dev: 0
      prod: 0

  - name: tsb-web
    ami_app_name: tsb-web
    security_groups:
      - srl-default
      - srl-web
      - srl-rmq-client
      - srl-sso-client
      - srl-logging
    instance_type: m3.xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: tsb-worker
    ami_app_name: tsb-worker
    security_groups:
      - srl-default
      - srl-db-client
      - srl-rmq-client
      - srl-glusterfs-udl-client
      - srl-logging
    instance_type: m3.xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: udl
    ami_app_name: udl
    security_groups:
      - srl-default
      - srl-db-client
      - srl-logging
    instance_type: m3.2xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: udl-db
    ami_app_name: db 
    security_groups:
      - srl-default
      - srl-db
      - srl-logging
    instance_type: m3.2xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: udl-rabbit
    ami_app_name: rabbit
    security_groups:
      - srl-default
      - srl-rmq
      - srl-logging
    instance_type: m3.xlarge
    spawn_count:
      dev: 0
      prod: 0

  - name: stats-db
    ami_app_name: db 
    security_groups:
      - srl-default
      - srl-db
      - srl-logging
    instance_type: m3.2xlarge
    spawn_count:
      dev: 0
      prod: 0

  #vpn:
  #  ami_app_name: base # TODO: remove this when the real AMI is available
  #  security_groups: # TODO
  #    - srl-default
  #  instance_type: m3.medium

  #- name: base
  #  security_groups: []
  #  instance_type: t1.micro

  #nat:
  #  ami_app_name: base # TODO: remove this when the real AMI is available
  #  security_groups: [] # TODO
  #  instance_type: m3.medium
